---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get recent updates from all content types
const laboEntries = await getCollection('labo');
const blogEntries = await getCollection('blog');
const reviewEntries = await getCollection('review');

// Combine and sort by date
const allEntries = [
  ...laboEntries.map(entry => ({ ...entry, type: 'labo' })),
  ...blogEntries.map(entry => ({ ...entry, type: 'blog' })),
  ...reviewEntries.map(entry => ({ ...entry, type: 'review' }))
].sort((a, b) => b.data.publishedAt.getTime() - a.data.publishedAt.getTime()).slice(0, 10);

// Category mappings
const categoryNames = {
  labo: {
    general: '全般',
    scenariomaking: 'シナリオ作成',
    system: 'システム'
  },
  blog: {
    general: '一般',
    game: 'ゲーム',
    dev: '開発',
    home: '家・インテリア',
    plants: '植物',
    travel: '旅行・グルメ'
  },
  review: {
    gadget: 'ガジェット',
    book: '本'
  }
};

const typeNames = {
  labo: '研究室',
  blog: 'ブログ',
  review: 'レビュー'
};
---

<Layout title="TRPG研究室 - ホーム">
  <h1>TRPG研究室へようこそ</h1>
  <p>テーブルトークRPGに関する研究、ブログ、レビューを発信しています。</p>

  <section>
    <h2>最近の更新</h2>
    <div class="recent-updates">
      {allEntries.map(entry => (
        <div class="update-item">
          <div class="meta">
            <span class="date">{entry.data.publishedAt.toISOString().split('T')[0]}</span>
            <span class="category">{typeNames[entry.type]}</span>
          </div>
          <h3>
            <a href={`/${entry.type}/${entry.slug}`}>{entry.data.title}</a>
          </h3>
        </div>
      ))}
    </div>
  </section>

  <div class="grid">
    <section class="card">
      <h3>研究室</h3>
      <p>TRPGに関する研究や情報をカテゴリ別にまとめています。</p>
      <h4>カテゴリ</h4>
      <ul>
        <li><a href="/labo">全般</a></li>
        <li><a href="/labo">シナリオ作成</a></li>
        <li><a href="/labo">システム</a></li>
      </ul>
      <p><a href="/labo">研究室一覧を見る →</a></p>
    </section>

    <section class="card">
      <h3>ブログ</h3>
      <p>TRPGや日常に関する記事を投稿しています。</p>
      <h4>カテゴリ</h4>
      <ul>
        <li><a href="/blog/general">一般</a></li>
        <li><a href="/blog/game">ゲーム</a></li>
        <li><a href="/blog/dev">開発</a></li>
        <li><a href="/blog/home">家・インテリア</a></li>
        <li><a href="/blog/plants">植物</a></li>
        <li><a href="/blog/travel">旅行・グルメ</a></li>
      </ul>
      <p><a href="/blog">ブログ一覧を見る →</a></p>
    </section>

    <section class="card">
      <h3>レビュー</h3>
      <p>ガジェットや本のレビューを5段階評価で紹介しています。</p>
      <h4>カテゴリ</h4>
      <ul>
        <li><a href="/review/gadget">ガジェット</a></li>
        <li><a href="/review/book">本</a></li>
      </ul>
      <p><a href="/review">レビュー一覧を見る →</a></p>
    </section>
  </div>

  <style>
    .recent-updates {
      margin: 1rem 0;
    }
    .update-item {
      border-bottom: 1px solid #eee;
      padding: 1rem 0;
    }
    .update-item:last-child {
      border-bottom: none;
    }
    .update-item h3 {
      margin: 0.5rem 0;
    }
    .update-item h3 a {
      color: #2c3e50;
      text-decoration: none;
    }
    .update-item h3 a:hover {
      color: #3498db;
    }
    .date {
      color: #666;
      margin-right: 1rem;
    }
  </style>
</Layout>
